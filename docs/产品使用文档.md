# AI客服系统 - 产品使用文档

## 📋 目录

1. [系统概述](#系统概述)
2. [用户角色](#用户角色)
3. [玩家端使用指南](#玩家端使用指南)
4. [客服端使用指南](#客服端使用指南)
5. [管理员使用指南](#管理员使用指南)
6. [常见问题](#常见问题)
7. [最佳实践](#最佳实践)

---

## 系统概述

AI客服系统是一个以"前置分流"和"智能路由"为核心的多游戏客服平台。系统通过AI智能判断问题紧急程度，自动分配到人工客服或工单系统，提高客服效率，优化用户体验。

### 核心流程

```
玩家提交问题 → AI智能分析 → 自动分流
    ↓
┌─────────────┬──────────────┬─────────────┐
│  紧急问题   │   一般问题    │   建议反馈   │
│  转人工客服  │   AI处理     │   提交工单   │
└─────────────┴──────────────┴─────────────┘
```

---

## 用户角色

系统包含三种用户角色：

### 1. 玩家 (Player)
- **权限**: 提交问题、与AI/客服聊天、查看工单状态
- **特点**: 无需登录，通过游戏信息验证身份

### 2. 客服 (Agent)
- **权限**: 接入会话、回复消息、管理工单、使用快捷回复
- **限制**: 只能查看分配给自己的会话，不能访问系统设置

### 3. 管理员 (Admin)
- **权限**: 所有功能，包括系统设置、用户管理、数据分析
- **特点**: 可以查看所有会话，可以重新分配会话

---

## 玩家端使用指南

### 1. 访问系统

打开玩家端地址（例如：`https://player.your-domain.com`）

### 2. 身份验证

#### 步骤1：选择游戏
- 在游戏列表中选择您要咨询的游戏
- 如果游戏未在列表中，请联系管理员添加

#### 步骤2：输入区服信息
- **方式一**：从下拉列表选择区服（如果已配置）
- **方式二**：手动输入区服名称

#### 步骤3：输入角色信息
- 输入您的游戏角色ID或昵称
- 系统会自动验证身份

### 3. 提交问题

#### 3.1 问题反馈表单

填写以下信息：

- **问题描述**（必填）：详细描述您遇到的问题，最多2000字
- **问题类型**（必填）：选择问题类型，如"充值问题"、"账号问题"等
- **问题发生时间**（可选）：选择问题发生的时间
- **问题截图**（可选）：上传相关截图，最多9张，支持JPG、PNG、GIF格式
- **最近一次充值订单号**（可选）：如果是充值相关问题，请填写订单号

#### 3.2 直接转人工

如果选择的问题类型支持"直接转人工"：

- **有客服在线**：系统会自动创建会话并进入排队
- **无客服在线**：系统会提示"已接到您的反馈，我们会尽快处理，目前暂时没有人工客服在线"

### 4. 与AI客服聊天

#### 4.1 开始对话

- 提交问题后，如果问题不需要直接转人工，会进入AI客服对话
- AI会根据您的问题提供智能回复

#### 4.2 转人工客服

在AI对话过程中，您可以：

- 点击"转人工"按钮
- 选择转人工原因
- 系统会自动进入排队或创建工单

**转人工后的情况**：

- **有客服在线**：
  - 进入排队，显示排队位置和预计等待时间
  - 客服接入后自动跳转到聊天界面
- **无客服在线**：
  - 显示提示信息
  - 问题会提交为工单，等待客服处理

### 5. 排队等待

#### 5.1 排队界面

当您进入排队后，会看到：

- **排队位置**：显示您当前在队列中的位置（如"第 3 位"）
- **预计等待时间**：系统估算的等待时间（如"约 15 分钟"）
- **实时更新**：排队信息会实时更新

#### 5.2 客服接入

- 当客服接入您的会话后，会自动跳转到聊天界面
- 您可以开始与客服进行实时对话

### 6. 与客服聊天

#### 6.1 发送消息

- 在输入框中输入消息
- 按 Enter 发送，Shift+Enter 换行
- 支持发送文本和图片

#### 6.2 上传文件

- 点击附件按钮（📎）
- 选择图片文件上传
- 支持预览上传的图片

#### 6.3 查看消息历史

- 聊天界面会显示所有历史消息
- 消息按时间顺序排列
- 可以区分AI、客服和您自己的消息

### 7. 查看工单

#### 7.1 工单状态

工单有以下状态：

- **待人工**：等待客服处理
- **处理中**：客服正在处理
- **已解决**：问题已解决

#### 7.2 工单聊天

- 如果问题提交为工单，可以在工单聊天界面与客服进行异步对话
- 客服回复后，您会收到通知

#### 7.3 工单自动关闭

**功能说明**：
- 系统会根据工单状态和不活跃时长自动关闭长时间无响应的工单
- 避免僵尸工单堆积，提高工单处理效率

**关闭规则**：
- **等待客服响应的工单**：72 小时（3天）后自动关闭
- **客服已回复的工单**：24 小时（1天）后自动关闭（如果玩家未响应）
- **玩家最后发送消息的工单**：不会自动关闭，等待客服回复

**手动关闭**：
- 如果问题已解决，请点击"问题已解决"按钮主动关闭工单
- 避免等待自动关闭，提高处理效率

**重新打开**：
- 如果工单被自动关闭但问题未解决，可以重新提交问题
- 联系客服说明情况，客服可以帮助重新打开工单

**注意事项**：
- 退出聊天界面不会立即关闭工单
- 工单会保持开启状态，可以稍后返回继续对话
- 建议问题解决后主动点击"问题已解决"按钮

### 8. 会话结束

#### 8.1 结束会话

- 客服或您可以主动结束会话
- 会话结束后，可以进行满意度评价

#### 8.2 满意度评价

- 对本次服务进行评分（1-5星）
- 可以填写评价意见
- 评价有助于改进服务质量

---

## 客服端使用指南

### 1. 登录系统

#### 1.1 访问管理端

打开管理端地址（例如：`https://admin.your-domain.com`）

#### 1.2 登录

- 输入用户名和密码
- 点击"登录"按钮
- 系统会记住登录状态

**默认账户**：
- 客服账户：`agent1` / `agent123`
- ⚠️ 生产环境请修改默认密码

### 2. 客服工作台

#### 2.1 工作台界面

工作台分为三个区域：

- **左侧面板**：会话列表
  - 待接入队列：显示等待接入的会话
  - 进行中会话：显示当前正在处理的会话
- **中间面板**：聊天界面
  - 显示当前会话的聊天内容
  - 消息输入框和发送按钮
- **右侧面板**：工单详情
  - 显示当前会话关联的工单信息
  - 包括游戏、区服、玩家信息等

#### 2.2 会话列表

**待接入队列**：
- 显示分配给您的会话或未分配的会话
- 显示排队位置和预计等待时间
- 显示问题类型和优先级

**进行中会话**：
- 显示您当前正在处理的会话
- 显示会话持续时间和状态

#### 2.3 接入会话

**步骤**：
1. 在"待接入队列"中找到要处理的会话
2. 点击会话卡片或"接入会话"按钮
3. 会话状态变为"进行中"
4. 可以开始与玩家聊天

**权限说明**：
- 客服只能接入分配给自己的会话
- 未分配的会话，任何客服都可以接入
- 管理员可以接入任何会话

### 3. 与玩家聊天

#### 3.1 发送消息

- 在输入框中输入回复内容
- 点击"发送"按钮或按 Enter 发送
- 支持 Shift+Enter 换行

#### 3.2 AI优化回复

**功能**：使用AI优化您的回复内容，使其更加专业和友好

**使用方法**：
1. 在输入框中输入回复内容
2. 点击"AI优化"按钮
3. 等待AI优化完成（通常几秒钟）
4. 优化后的内容会自动填入输入框
5. 可以继续编辑或直接发送
6. 如果不满意，可以按 Ctrl+Z 恢复原内容

**注意事项**：
- AI优化需要网络连接
- 优化结果仅供参考，请根据实际情况调整
- 如果AI优化失败，可以正常发送消息

#### 3.3 快捷回复

**功能**：使用预设的快捷回复模板，提高回复效率

**使用方法**：
1. 点击输入框上方的"快捷回复"按钮（⚡图标）
2. 在右侧抽屉中选择分类
3. 点击要使用的快捷回复
4. 内容会自动填入输入框
5. 可以继续编辑或直接发送

**个人偏好**：
- 普通用户可以管理自己的快捷回复偏好
- 可以启用/禁用快捷回复（只影响自己）
- 可以修改快捷回复内容（只影响自己）
- 管理员和创建者可以修改全局快捷回复

#### 3.4 发送文件

**步骤**：
1. 点击附件按钮（📎）
2. 选择要发送的文件（支持图片、PDF、Word、Excel等）
3. 文件会自动上传并发送

**限制**：
- 单个文件最大 10MB
- 支持常见图片格式和文档格式

#### 3.5 查看消息历史

- 聊天界面会显示所有历史消息
- 消息按时间顺序排列
- 可以区分玩家、AI和您自己的消息

### 4. 查看工单信息

#### 4.1 工单详情

在右侧面板可以查看：

- **工单号**：唯一标识，可复制
- **游戏信息**：游戏名称、区服
- **玩家信息**：玩家ID/昵称
- **问题类型**：选择的问题类型
- **问题描述**：玩家提交的详细描述
- **附件**：玩家上传的截图
- **状态跟踪**：工单和会话的状态时间线

#### 4.2 工单操作

- 查看工单状态和历史
- 了解问题的完整背景
- 根据工单信息提供针对性回复

### 5. 结束会话

#### 5.1 结束会话

**步骤**：
1. 在聊天界面右上角点击"结束会话"按钮
2. 确认结束会话
3. 会话状态变为"已结束"

**注意事项**：
- 结束会话后，玩家无法继续发送消息
- 如果问题未解决，可以建议玩家重新提交
- 会话结束后，玩家可以进行满意度评价

### 6. 工单管理

#### 6.1 查看工单列表

在"工单管理"页面可以：

- 查看所有工单
- 按状态筛选（待人工、处理中、已解决）
- 按游戏筛选
- 按时间范围筛选
- 搜索工单号或玩家信息

#### 6.2 工单操作

- **查看详情**：点击工单查看详细信息
- **处理工单**：对于"待人工"状态的工单，可以创建会话进行处理
- **修改状态**：管理员可以修改工单状态

---

## 管理员使用指南

管理员拥有所有权限，除了客服功能外，还可以进行系统配置和管理。

### 1. 系统设置

#### 1.1 游戏管理

**添加游戏**：
1. 进入"系统设置" → "游戏管理"
2. 点击"新增游戏"
3. 填写游戏信息：
   - 游戏名称
   - 游戏图标（可选）
   - Dify API Key
   - Dify Base URL
4. 保存

**编辑游戏**：
- 点击游戏列表中的"编辑"按钮
- 修改游戏信息
- 保存更改

**删除游戏**：
- 点击"删除"按钮
- 确认删除（注意：删除游戏会影响相关工单和会话）

#### 1.2 区服管理

**添加区服**：
1. 选择游戏
2. 点击"新增区服"
3. 填写区服名称
4. 保存

**批量导入**：
- 支持批量导入区服
- 使用CSV格式文件

#### 1.3 问题类型管理

**添加问题类型**：
1. 进入"系统设置" → "问题类型"
2. 点击"新增问题类型"
3. 填写信息：
   - 问题类型名称
   - 描述
   - 优先级权重（1-100）
   - 是否直接转人工
   - 排序顺序
4. 保存

**配置说明**：
- **优先级权重**：数值越大，优先级越高，在排队队列中越靠前
- **直接转人工**：如果勾选，选择该问题类型的工单会直接进入人工客服队列
- **排序顺序**：控制在前端显示的顺序

#### 1.4 快捷回复管理

**创建分类**：
1. 进入"系统设置" → "快捷回复"
2. 点击"新增分类"
3. 填写分类名称
4. 保存

**创建快捷回复**：
1. 选择分类
2. 点击"+ 新增回复"
3. 填写回复内容
4. 设置是否全局（管理员可见）
5. 保存

**管理快捷回复**：
- **启用/禁用**：点击开关按钮
- **编辑**：点击"编辑"按钮修改内容
- **删除**：点击"删除"按钮
- **个人偏好**：普通用户可以设置个人偏好（只影响自己）

**快捷回复使用**：
- 在工作台聊天界面使用快捷回复
- 支持按分类、收藏、使用频率筛选
- 支持搜索快捷回复内容

### 2. 用户管理

#### 2.1 创建用户

**创建客服**：
1. 进入"系统设置" → "用户管理"
2. 点击"新增用户"
3. 填写信息：
   - 用户名
   - 密码
   - 真实姓名
   - 角色（选择"客服"）
4. 保存

**创建管理员**：
- 步骤同上，角色选择"管理员"

#### 2.2 管理用户

- **编辑用户**：修改用户信息
- **重置密码**：重置用户密码
- **禁用用户**：禁用用户账号（用户无法登录）
- **删除用户**：删除用户账号（谨慎操作）

### 3. 数据分析

#### 3.1 仪表盘

在"数据分析"页面可以查看：

- **今日数据**：
  - 新增工单数
  - 处理中工单数
  - 已解决工单数
  - 在线客服数
- **趋势图表**：
  - 工单趋势
  - 会话趋势
  - 满意度趋势
- **游戏数据**：
  - 各游戏的工单分布
  - 各游戏的处理效率

#### 3.2 数据导出

- 支持导出工单数据
- 支持导出会话数据
- 支持按时间范围导出

### 4. 会话管理

#### 4.1 查看所有会话

在"会话管理"页面可以：

- 查看所有会话（不限于分配给自己的）
- 按状态筛选
- 按游戏筛选
- 按时间范围筛选
- 搜索会话

#### 4.2 会话操作

- **查看详情**：点击会话查看详细信息
- **重新分配**：将会话分配给其他客服
- **结束会话**：强制结束会话

### 5. 工单管理

#### 5.1 工单操作

- **查看所有工单**：不限于分配给自己的
- **修改状态**：修改工单状态
- **重新分配**：将工单分配给其他客服
- **批量操作**：批量修改工单状态

#### 5.2 工单统计

- 查看工单处理效率
- 查看各游戏工单分布
- 查看问题类型分布

---

## 常见问题

### 玩家端常见问题

#### Q1: 为什么我无法提交问题？

**可能原因**：
- 未选择游戏
- 未选择问题类型
- 问题描述为空
- 网络连接问题

**解决方法**：
- 检查必填项是否都已填写
- 检查网络连接
- 刷新页面重试

#### Q2: 为什么我一直显示"排队中"？

**可能原因**：
- 当前没有客服在线
- 排队人数较多

**解决方法**：
- 等待客服上线
- 查看排队位置和预计等待时间
- 如果等待时间过长，可以稍后再试

#### Q3: 如何查看我的工单？

**方法**：
- 使用工单号查询
- 使用游戏信息（游戏、区服、角色名）查询
- 联系客服查询

#### Q4: 可以上传哪些类型的文件？

**支持格式**：
- 图片：JPG、PNG、GIF
- 文档：PDF、Word、Excel、TXT
- 压缩包：ZIP、RAR

**限制**：
- 单个文件最大 10MB
- 图片最多 9 张

### 客服端常见问题

#### Q1: 为什么我看不到待接入队列？

**可能原因**：
- 当前没有待接入的会话
- 会话已分配给其他客服
- 权限问题

**解决方法**：
- 刷新页面
- 检查是否有新会话
- 联系管理员检查权限

#### Q2: AI优化功能无法使用？

**可能原因**：
- Dify API配置错误
- 网络连接问题
- API Key无效

**解决方法**：
- 检查Dify API配置
- 检查网络连接
- 联系管理员检查API配置

#### Q3: 如何管理快捷回复？

**方法**：
- 进入"系统设置" → "快捷回复"
- 创建分类和回复内容
- 在工作台使用快捷回复
- 设置个人偏好（只影响自己）

#### Q4: 如何查看会话历史？

**方法**：
- 在"会话管理"页面查看
- 可以按时间范围筛选
- 可以搜索特定会话

### 管理员常见问题

#### Q1: 如何配置Dify AI？

**步骤**：
1. 在Dify平台创建应用
2. 获取API Key和Base URL
3. 在"游戏管理"中配置
4. 测试AI功能

**详细说明**：参考 [Dify配置指南](./Dify配置指南.md)

#### Q2: 如何设置问题类型的优先级？

**方法**：
- 在"问题类型管理"中设置"优先级权重"
- 权重值越大，优先级越高
- 系统会根据权重自动排序排队队列

#### Q3: 如何备份数据？

**方法**：
- 定期备份PostgreSQL数据库
- 备份上传的文件（uploads目录）
- 参考 [生产环境部署指南](./生产环境部署指南.md#备份和恢复)

---

## 最佳实践

### 玩家端

1. **详细描述问题**：
   - 提供尽可能详细的问题描述
   - 上传相关截图
   - 提供订单号（如果是充值问题）

2. **选择正确的问题类型**：
   - 选择最匹配的问题类型
   - 紧急问题选择"直接转人工"类型

3. **耐心等待**：
   - 查看排队位置和预计等待时间
   - 不要频繁刷新页面

### 客服端

1. **及时接入会话**：
   - 定期查看待接入队列
   - 及时接入分配给自己的会话

2. **使用AI优化**：
   - 对于重要回复，使用AI优化功能
   - 优化后根据实际情况调整

3. **使用快捷回复**：
   - 创建常用回复模板
   - 提高回复效率

4. **查看工单信息**：
   - 接入会话前先查看工单详情
   - 了解问题的完整背景

5. **专业回复**：
   - 保持专业和友好的语气
   - 提供准确的信息
   - 及时解决问题

### 管理员

1. **定期维护**：
   - 定期检查系统运行状态
   - 查看日志文件
   - 监控系统性能

2. **数据备份**：
   - 定期备份数据库
   - 备份重要文件

3. **用户管理**：
   - 及时创建和删除用户
   - 定期更新用户密码
   - 禁用不再使用的账户

4. **配置优化**：
   - 根据实际情况调整问题类型优先级
   - 优化快捷回复内容
   - 配置合适的Dify参数

5. **监控告警**：
   - 设置系统监控
   - 配置告警规则
   - 及时处理异常情况

---

## 功能特性说明

### 1. 智能分流

系统会根据问题类型自动判断：

- **紧急问题**（如充值问题）：直接转人工客服
- **一般问题**：先由AI处理，需要时转人工
- **建议反馈**：提交为工单，异步处理

### 2. 自动分配

- 系统会自动将会话分配给负载最少的客服
- 如果所有客服都忙，会话会进入排队
- 管理员可以手动重新分配会话

### 3. 排队系统

- 实时显示排队位置
- 计算预计等待时间
- 自动更新排队信息

### 4. AI优化

- 优化客服回复内容
- 提升专业度和友好度
- 支持一键恢复原内容

### 5. 快捷回复

- 预设常用回复模板
- 支持分类管理
- 支持个人偏好设置
- 支持搜索和筛选

### 6. 工单管理

- 完整的工单生命周期
- 支持附件上传
- 支持状态跟踪
- 支持异步处理

---

## 技术支持

如遇到技术问题，请：

1. 查看本文档的"常见问题"部分
2. 查看 [技术文档](./技术文档.md)
3. 查看系统日志
4. 联系技术支持团队

---

**文档版本**: 1.0  
**最后更新**: 2025-01-01  
**维护者**: 开发团队

