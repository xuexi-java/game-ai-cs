# ç”Ÿäº§çŽ¯å¢ƒéƒ¨ç½²æ£€æŸ¥æ¸…å•

## ðŸ“‹ éƒ¨ç½²å‰æ£€æŸ¥

### æœåŠ¡å™¨å‡†å¤‡
- [ ] æœåŠ¡å™¨å·²å‡†å¤‡ï¼ˆCPU 2æ ¸+, å†…å­˜ 4GB+, ç¡¬ç›˜ 50GB+ï¼‰
- [ ] æ“ä½œç³»ç»Ÿå·²å®‰è£…ï¼ˆUbuntu 20.04+ æŽ¨èï¼‰
- [ ] åŸŸåå·²å¤‡æ¡ˆï¼ˆå¦‚éœ€è¦ï¼‰
- [ ] DNS å·²è§£æžåˆ°æœåŠ¡å™¨ IP

### åŸŸåå’Œè¯ä¹¦
- [ ] ç®¡ç†åŽå°åŸŸåï¼š`cs-admin.yourdomain.com`
- [ ] åŽç«¯ API åŸŸåï¼š`cs-api.yourdomain.com`
- [ ] çŽ©å®¶ç«¯åŸŸåï¼š`cs-player.yourdomain.com`
- [ ] SSL è¯ä¹¦å·²ç”³è¯·ï¼ˆLet's Encrypt æˆ–äº‘æœåŠ¡å•†ï¼‰

### è½¯ä»¶å®‰è£…
- [ ] Node.js 20.xï¼ˆé¡¹ç›®è¦æ±‚ 20.19.5+ï¼‰
- [ ] PostgreSQL 14.x+
- [ ] Redis 7.x+ï¼ˆé¡¹ç›®ä½¿ç”¨ Redis 7-alpineï¼‰
- [ ] Nginx 1.18+
- [ ] PM2 æˆ– Dockerï¼ˆæŽ¨è Docker æ–¹å¼ï¼‰

---

## ðŸ” å®‰å…¨é…ç½®

### å¯†é’¥ç”Ÿæˆ
ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤ç”Ÿæˆæ‰€æœ‰å¯†é’¥ï¼Œå¹¶è®°å½•ä¸‹æ¥ï¼š

```bash
# ç”Ÿæˆ 6 ä¸ªä¸åŒçš„å¯†é’¥
for i in {1..6}; do echo "å¯†é’¥$i: $(openssl rand -base64 32)"; done

# ç”ŸæˆåŠ å¯†å¯†é’¥
echo "åŠ å¯†å¯†é’¥: $(openssl rand -hex 32)"
```

- [ ] JWT_SECRETï¼ˆå¯†é’¥1ï¼‰
- [ ] WS_TOKEN_SECRETï¼ˆå¯†é’¥2ï¼‰
- [ ] UPLOAD_TOKEN_SECRETï¼ˆå¯†é’¥3ï¼‰
- [ ] SESSION_TOKEN_SECRETï¼ˆå¯†é’¥4ï¼‰
- [ ] METRICS_KEYï¼ˆå¯†é’¥5ï¼‰
- [ ] ENCRYPTION_SALTï¼ˆå¯†é’¥6ï¼‰
- [ ] ENCRYPTION_SECRET_KEYï¼ˆåŠ å¯†å¯†é’¥ï¼‰

### æ•°æ®åº“å®‰å…¨
- [ ] åˆ›å»ºä¸“ç”¨æ•°æ®åº“ç”¨æˆ·ï¼ˆä¸ä½¿ç”¨ postgresï¼‰
- [ ] è®¾ç½®å¼ºå¯†ç ï¼ˆè‡³å°‘ 16 ä½ï¼‰
- [ ] é™åˆ¶æ•°æ®åº“è¿œç¨‹è®¿é—®ï¼ˆå¦‚ä¸éœ€è¦ï¼‰

---

## âš™ï¸ é…ç½®æ–‡ä»¶ä¿®æ”¹

### backend/.env
```bash
# å¿…é¡»ä¿®æ”¹çš„é…ç½®
DATABASE_URL="postgresql://cs_app:å¼ºå¯†ç @localhost:5432/cs_prod_db?schema=public"
JWT_SECRET="ç”Ÿæˆçš„å¯†é’¥1"
REDIS_URL="redis://localhost:6379"
NODE_ENV="production"
PORT=21101
LOG_LEVEL="INFO"
FRONTEND_URL="https://cs-admin.yourdomain.com"
WS_URL="wss://cs-api.yourdomain.com"
DIFY_API_KEY="ç”Ÿäº§çŽ¯å¢ƒçš„key"
DIFY_BASE_URL="https://your-dify-domain.com/v1"
ENCRYPTION_SECRET_KEY="ç”Ÿæˆçš„åŠ å¯†å¯†é’¥"
ENCRYPTION_SALT="ç”Ÿæˆçš„å¯†é’¥6"
WS_TOKEN_SECRET="ç”Ÿæˆçš„å¯†é’¥2"
UPLOAD_TOKEN_SECRET="ç”Ÿæˆçš„å¯†é’¥3"
SESSION_TOKEN_SECRET="ç”Ÿæˆçš„å¯†é’¥4"
METRICS_KEY="ç”Ÿæˆçš„å¯†é’¥5"
```

- [ ] DATABASE_URL å·²ä¿®æ”¹
- [ ] æ‰€æœ‰å¯†é’¥å·²æ›¿æ¢
- [ ] NODE_ENV æ”¹ä¸º production
- [ ] FRONTEND_URL æ”¹ä¸ºç”Ÿäº§åŸŸå
- [ ] WS_URL æ”¹ä¸º wss://
- [ ] Dify é…ç½®å·²æ›´æ–°

### frontend/admin-portal/.env
```bash
VITE_API_BASE_URL=https://cs-api.yourdomain.com/api/v1
VITE_WS_URL=wss://cs-api.yourdomain.com
```

- [ ] API åœ°å€å·²ä¿®æ”¹ä¸ºç”Ÿäº§åŸŸå
- [ ] WebSocket åœ°å€ä½¿ç”¨ wss://

### webview-player/.envï¼ˆå¯é€‰ï¼‰
```bash
VITE_API_URL=https://cs-api.yourdomain.com
```

- [ ] API åœ°å€å·²é…ç½®ï¼ˆæˆ–é€šè¿‡ URL å‚æ•°ä¼ é€’ï¼‰

---

## ðŸ—„ï¸ æ•°æ®åº“åˆå§‹åŒ–

```bash
cd backend

# 1. æ‰§è¡Œè¿ç§»
npx prisma migrate deploy

# 2. åˆ›å»ºåˆå§‹ç®¡ç†å‘˜
npm run seed
```

- [ ] æ•°æ®åº“è¿ç§»å·²æ‰§è¡Œ
- [ ] åˆå§‹ç®¡ç†å‘˜è´¦å·å·²åˆ›å»º
- [ ] é»˜è®¤å¯†ç å·²è®°å½•ï¼ˆadmin / admin123, admin2 / admin123ï¼‰
- [ ] å®¢æœè´¦å·å·²è®°å½•ï¼ˆagent1~agent3 / agent123ï¼‰

---

## ðŸ—ï¸ æž„å»ºé¡¹ç›®

### åŽç«¯
```bash
cd backend
pnpm install
pnpm build
```
- [ ] åŽç«¯ä¾èµ–å·²å®‰è£…
- [ ] åŽç«¯å·²æž„å»ºæˆåŠŸ

### ç®¡ç†åŽå°
```bash
cd frontend/admin-portal
pnpm install
pnpm build
```
- [ ] ç®¡ç†åŽå°ä¾èµ–å·²å®‰è£…
- [ ] ç®¡ç†åŽå°å·²æž„å»ºæˆåŠŸ

### çŽ©å®¶ç«¯
```bash
cd webview-player
pnpm install
pnpm build
```
- [ ] çŽ©å®¶ç«¯ä¾èµ–å·²å®‰è£…
- [ ] çŽ©å®¶ç«¯å·²æž„å»ºæˆåŠŸ

---

## ðŸš€ éƒ¨ç½²æœåŠ¡

### æ–¹å¼ A: PM2 éƒ¨ç½²
```bash
cd backend
# åˆ›å»º ecosystem.config.jsï¼ˆå¦‚ä¸å­˜åœ¨ï¼‰
cat > ecosystem.config.js << 'EOF'
module.exports = {
  apps: [{
    name: 'game-ai-cs-backend',
    script: 'dist/main.js',
    instances: 1,
    exec_mode: 'fork',
    env_production: {
      NODE_ENV: 'production',
      PORT: 21101
    }
  }]
};
EOF

pm2 start ecosystem.config.js --env production
pm2 save
pm2 startup
```
- [ ] ecosystem.config.js å·²åˆ›å»º
- [ ] PM2 å·²å¯åŠ¨åŽç«¯
- [ ] PM2 å·²ä¿å­˜é…ç½®
- [ ] PM2 å¼€æœºè‡ªå¯å·²é…ç½®

### æ–¹å¼ B: Docker éƒ¨ç½²ï¼ˆæŽ¨èï¼‰
```bash
# è®¾ç½®å¿…è¦çš„çŽ¯å¢ƒå˜é‡
export POSTGRES_PASSWORD="ä½ çš„æ•°æ®åº“å¼ºå¯†ç "
export JWT_SECRET="ä½ çš„JWTå¯†é’¥"
export ENCRYPTION_SECRET_KEY="ä½ çš„åŠ å¯†å¯†é’¥ï¼ˆè‡³å°‘32å­—ç¬¦ï¼‰"
export ENCRYPTION_SALT="ä½ çš„ç›å€¼"
export WS_URL="wss://cs-api.yourdomain.com"
export DIFY_API_KEY="ä½ çš„Dify API Key"

# å¯åŠ¨æœåŠ¡
docker-compose up -d
```
- [ ] çŽ¯å¢ƒå˜é‡å·²è®¾ç½®
- [ ] Docker æœåŠ¡å·²å¯åŠ¨
- [ ] å®¹å™¨è¿è¡Œæ­£å¸¸ï¼ˆpostgres, redis, backend, admin-portalï¼‰

---

## ðŸŒ Nginx é…ç½®

### é…ç½®æ–‡ä»¶
- [ ] `/etc/nginx/sites-available/cs-api` å·²åˆ›å»º
- [ ] `/etc/nginx/sites-available/cs-admin` å·²åˆ›å»º
- [ ] `/etc/nginx/sites-available/cs-player` å·²åˆ›å»º
- [ ] è½¯é“¾æŽ¥å·²åˆ›å»ºåˆ° sites-enabled
- [ ] SSL è¯ä¹¦è·¯å¾„å·²é…ç½®
- [ ] åŸŸåå·²æ›¿æ¢ä¸ºå®žé™…åŸŸå

### å‰ç«¯æ–‡ä»¶éƒ¨ç½²
```bash
sudo mkdir -p /var/www/admin-portal
sudo mkdir -p /var/www/webview-player
sudo cp -r frontend/admin-portal/dist/* /var/www/admin-portal/
sudo cp -r webview-player/dist/* /var/www/webview-player/
sudo chown -R www-data:www-data /var/www/admin-portal
sudo chown -R www-data:www-data /var/www/webview-player
```
- [ ] å‰ç«¯æ–‡ä»¶å·²å¤åˆ¶åˆ° Nginx ç›®å½•
- [ ] æ–‡ä»¶æƒé™å·²è®¾ç½®

### å¯åŠ¨ Nginx
```bash
sudo nginx -t
sudo systemctl restart nginx
```
- [ ] Nginx é…ç½®æµ‹è¯•é€šè¿‡
- [ ] Nginx å·²é‡å¯

---

## âœ… åŠŸèƒ½éªŒè¯

### åŸºç¡€æœåŠ¡æ£€æŸ¥
```bash
# åŽç«¯å¥åº·æ£€æŸ¥
curl https://cs-api.yourdomain.com/api/v1/health

# PostgreSQL
psql -U cs_app -d cs_prod_db -c "SELECT version();"

# Redis
redis-cli ping

# Nginx
sudo systemctl status nginx
```
- [ ] åŽç«¯ API å“åº”æ­£å¸¸
- [ ] æ•°æ®åº“è¿žæŽ¥æ­£å¸¸
- [ ] Redis è¿žæŽ¥æ­£å¸¸
- [ ] Nginx è¿è¡Œæ­£å¸¸

### ç®¡ç†åŽå°æµ‹è¯•
1. è®¿é—® `https://cs-admin.yourdomain.com`
2. ä½¿ç”¨é»˜è®¤è´¦å·ç™»å½•ï¼ˆadmin / admin123ï¼‰
3. ä¿®æ”¹ç®¡ç†å‘˜å¯†ç 
4. æ·»åŠ æµ‹è¯•æ¸¸æˆ

- [ ] ç®¡ç†åŽå°å¯è®¿é—®
- [ ] ç™»å½•åŠŸèƒ½æ­£å¸¸
- [ ] å¯†ç å·²ä¿®æ”¹
- [ ] å¯ä»¥æ·»åŠ æ¸¸æˆ

### çŽ©å®¶ç«¯æµ‹è¯•
1. è®¿é—® `https://cs-player.yourdomain.com?apiUrl=https://cs-api.yourdomain.com`
2. æµ‹è¯•åˆ›å»ºå·¥å•
3. æµ‹è¯•å‘é€æ¶ˆæ¯
4. æµ‹è¯•å›¾ç‰‡ä¸Šä¼ 

- [ ] çŽ©å®¶ç«¯å¯è®¿é—®
- [ ] å¯ä»¥åˆ›å»ºå·¥å•
- [ ] å¯ä»¥å‘é€æ¶ˆæ¯
- [ ] å›¾ç‰‡ä¸Šä¼ æ­£å¸¸

### WebSocket æµ‹è¯•
```bash
npm install -g wscat
wscat -c "wss://cs-api.yourdomain.com/socket.io/?EIO=4&transport=websocket"
```
- [ ] WebSocket è¿žæŽ¥æˆåŠŸ
- [ ] å¯ä»¥æ”¶å‘æ¶ˆæ¯

---

## ðŸ”§ ç›‘æŽ§å’Œç»´æŠ¤

### æ—¥å¿—é…ç½®
- [ ] æ—¥å¿—è½®è½¬å·²é…ç½®
- [ ] æ—¥å¿—ç›®å½•æƒé™æ­£ç¡®
- [ ] å¯ä»¥æŸ¥çœ‹å®žæ—¶æ—¥å¿—

### å¤‡ä»½é…ç½®
```bash
# æ•°æ®åº“å¤‡ä»½è„šæœ¬
sudo nano /usr/local/bin/backup-cs-db.sh
sudo chmod +x /usr/local/bin/backup-cs-db.sh

# å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ·»åŠ : 0 3 * * * /usr/local/bin/backup-cs-db.sh
```
- [ ] æ•°æ®åº“å¤‡ä»½è„šæœ¬å·²åˆ›å»º
- [ ] å®šæ—¶å¤‡ä»½å·²é…ç½®
- [ ] å¤‡ä»½ç›®å½•å·²åˆ›å»º

### SSL è¯ä¹¦è‡ªåŠ¨ç»­æœŸ
```bash
# æµ‹è¯•ç»­æœŸ
sudo certbot renew --dry-run

# å®šæ—¶ä»»åŠ¡
sudo crontab -e
# æ·»åŠ : 0 2 * * * certbot renew --quiet --post-hook "systemctl reload nginx"
```
- [ ] è¯ä¹¦è‡ªåŠ¨ç»­æœŸæµ‹è¯•é€šè¿‡
- [ ] å®šæ—¶ç»­æœŸä»»åŠ¡å·²é…ç½®

### ç›‘æŽ§å·¥å…·
```bash
# å®‰è£…ç›‘æŽ§å·¥å…·
sudo apt install htop iotop nethogs

# PM2 ç›‘æŽ§
pm2 monit
```
- [ ] ç³»ç»Ÿç›‘æŽ§å·¥å…·å·²å®‰è£…
- [ ] PM2 ç›‘æŽ§å¯ç”¨

---

## ðŸ”’ å®‰å…¨åŠ å›º

### é˜²ç«å¢™é…ç½®
```bash
# UFW é˜²ç«å¢™
sudo ufw allow 22/tcp    # SSH
sudo ufw allow 80/tcp    # HTTP
sudo ufw allow 443/tcp   # HTTPS
sudo ufw enable
```
- [ ] é˜²ç«å¢™å·²å¯ç”¨
- [ ] åªå¼€æ”¾å¿…è¦ç«¯å£

### SSH å®‰å…¨
```bash
# ç¦ç”¨å¯†ç ç™»å½•ï¼Œä½¿ç”¨å¯†é’¥
sudo nano /etc/ssh/sshd_config
# PasswordAuthentication no
sudo systemctl restart sshd
```
- [ ] SSH å¯†é’¥ç™»å½•å·²é…ç½®
- [ ] å¯†ç ç™»å½•å·²ç¦ç”¨ï¼ˆå¯é€‰ï¼‰

### ç³»ç»Ÿæ›´æ–°
```bash
sudo apt update
sudo apt upgrade -y
```
- [ ] ç³»ç»Ÿå·²æ›´æ–°åˆ°æœ€æ–°

---

## ðŸ“ æœ€ç»ˆæ£€æŸ¥

### é…ç½®ç¡®è®¤
- [ ] æ‰€æœ‰ localhost å·²æ”¹ä¸ºç”Ÿäº§åŸŸå
- [ ] æ‰€æœ‰ http:// å·²æ”¹ä¸º https://
- [ ] æ‰€æœ‰ ws:// å·²æ”¹ä¸º wss://
- [ ] æ‰€æœ‰ç¤ºä¾‹å¯†é’¥å·²æ›¿æ¢
- [ ] NODE_ENV ä¸º production
- [ ] æ—¥å¿—çº§åˆ«ä¸º INFO æˆ– WARN

### å®‰å…¨ç¡®è®¤
- [ ] é»˜è®¤ç®¡ç†å‘˜å¯†ç å·²ä¿®æ”¹
- [ ] æ•°æ®åº“å¯†ç è¶³å¤Ÿå¼º
- [ ] æ‰€æœ‰å¯†é’¥å·²é‡æ–°ç”Ÿæˆ
- [ ] CORS é…ç½®æ­£ç¡®
- [ ] é˜²ç«å¢™å·²é…ç½®

### åŠŸèƒ½ç¡®è®¤
- [ ] ç®¡ç†åŽå°å¯æ­£å¸¸ä½¿ç”¨
- [ ] çŽ©å®¶ç«¯å¯æ­£å¸¸ä½¿ç”¨
- [ ] WebSocket è¿žæŽ¥æ­£å¸¸
- [ ] æ–‡ä»¶ä¸Šä¼ åŠŸèƒ½æ­£å¸¸
- [ ] AI å¯¹è¯åŠŸèƒ½æ­£å¸¸

### è¿ç»´ç¡®è®¤
- [ ] æ—¥å¿—å¯æ­£å¸¸æŸ¥çœ‹
- [ ] æ•°æ®åº“å¤‡ä»½å·²é…ç½®
- [ ] SSL è¯ä¹¦è‡ªåŠ¨ç»­æœŸå·²é…ç½®
- [ ] ç›‘æŽ§å·¥å…·å·²å®‰è£…
- [ ] æ–‡æ¡£å·²å½’æ¡£

---

## ðŸŽ‰ éƒ¨ç½²å®Œæˆ

æ­å–œï¼ç³»ç»Ÿå·²æˆåŠŸéƒ¨ç½²åˆ°ç”Ÿäº§çŽ¯å¢ƒã€‚

### ä¸‹ä¸€æ­¥
1. é€šçŸ¥æ¸¸æˆæœåŠ¡å™¨å›¢é˜Ÿæ›´æ–°é…ç½®
2. æä¾›çŽ©å®¶ç«¯æŽ¥å…¥æ–‡æ¡£
3. åŸ¹è®­å®¢æœäººå‘˜ä½¿ç”¨ç³»ç»Ÿ
4. ç›‘æŽ§ç³»ç»Ÿè¿è¡ŒçŠ¶æ€
5. å®šæœŸæ£€æŸ¥æ—¥å¿—å’Œå¤‡ä»½

### é‡è¦æé†’
- å®šæœŸæ£€æŸ¥ SSL è¯ä¹¦æœ‰æ•ˆæœŸ
- å®šæœŸæ£€æŸ¥æ•°æ®åº“å¤‡ä»½
- å®šæœŸæ›´æ–°ç³»ç»Ÿå’Œä¾èµ–
- å…³æ³¨ç³»ç»Ÿæ€§èƒ½æŒ‡æ ‡
- åŠæ—¶å¤„ç†é”™è¯¯æ—¥å¿—

---

**æ£€æŸ¥æ¸…å•ç‰ˆæœ¬**: v1.1
**æœ€åŽæ›´æ–°**: 2026-01-22

### æ›´æ–°è®°å½•
- v1.1 (2026-01-22): ä¿®æ­£é»˜è®¤å¯†ç ã€Node.js/Redis ç‰ˆæœ¬è¦æ±‚ã€PM2 é…ç½®ç¤ºä¾‹ã€Docker éƒ¨ç½²è¯´æ˜Ž
- v1.0 (2026-01-21): åˆå§‹ç‰ˆæœ¬
