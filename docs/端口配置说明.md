# 端口配置说明

## 系统端口分配

### 前端应用
| 应用 | 端口 | 访问地址 | 说明 |
|------|------|----------|------|
| 管理端 (admin-portal) | 20101 | http://localhost:20101 | 客服工作台、管理后台 |
| 玩家端 (player-app) | 20102 | http://localhost:20102 | 玩家提交工单、查看进度 |

### 后端服务
| 服务 | 端口 | 访问地址 | 说明 |
|------|------|----------|------|
| 后端API | 21101 | http://localhost:21101/api/v1 | RESTful API |
| WebSocket | 21101 | ws://localhost:21101 | 实时通信 |

### 数据库和中间件
| 服务 | 端口 | 说明 |
|------|------|------|
| PostgreSQL | 22101 | 数据库 |
| Redis | 22102 | 缓存和消息队列 |

### 监控服务
| 服务 | 端口 | 访问地址 | 说明 |
|------|------|----------|------|
| Prometheus | 23101 | http://localhost:23101 | 指标收集 |
| Grafana | 23103 | http://localhost:23103 | 可视化监控 |
| Loki | 23102 | http://localhost:23102 | 日志聚合 |

## 配置文件位置

### 前端配置
- **管理端**: `frontend/admin-portal/vite.config.ts`
  ```typescript
  server: {
    port: 20101,
  }
  ```

- **玩家端**: `frontend/player-app/vite.config.ts`
  ```typescript
  server: {
    port: 20102,
  }
  ```

### 后端配置
- **环境变量**: `backend/.env`
  ```env
  PORT=21101
  ```

### 数据库配置
- **环境变量**: `backend/.env`
  ```env
  DATABASE_URL=postgresql://postgres:postgres@localhost:22101/game_ai_cs?schema=public
  REDIS_URL=redis://localhost:22102
  ```

## 如何访问

### 开发环境
1. **管理端（客服工作台）**
   - 访问: http://localhost:20101
   - 默认账号: admin / admin123

2. **玩家端（提交工单）**
   - 访问: http://localhost:20102
   - 无需登录，直接提交工单

### 生产环境
通过Nginx反向代理统一访问：
- 管理端: https://your-domain.com/admin
- 玩家端: https://your-domain.com/player
- API: https://your-domain.com/api

## 端口冲突解决

如果端口被占用，可以修改配置：

### 修改前端端口
编辑 `vite.config.ts`:
```typescript
server: {
  port: 新端口号,
}
```

### 修改后端端口
编辑 `backend/.env`:
```env
PORT=新端口号
```

注意：修改后端端口后，需要同步更新前端的API配置。

## 当前运行状态检查

### Windows
```powershell
# 检查管理端
netstat -ano | findstr "20101"

# 检查玩家端
netstat -ano | findstr "20102"

# 检查后端
netstat -ano | findstr "21101"
```

### Linux/Mac
```bash
# 检查管理端
lsof -i :20101

# 检查玩家端
lsof -i :20102

# 检查后端
lsof -i :21101
```

## 启动顺序

1. **启动数据库和Redis**（Docker）
   ```bash
   docker-compose up -d postgres redis
   ```

2. **启动后端服务**
   ```bash
   cd backend
   npm run dev
   ```

3. **启动前端服务**
   ```bash
   # 管理端
   cd frontend/admin-portal
   npm run dev

   # 玩家端（新终端）
   cd frontend/player-app
   npm run dev
   ```

## 常见问题

### Q: 为什么浏览器显示两个都是管理端？
A: 请检查浏览器地址栏：
- 管理端应该是 `localhost:20101`
- 玩家端应该是 `localhost:20102`

如果都显示20101，说明打开的是同一个应用。

### Q: 如何确认玩家端是否正在运行？
A: 运行命令检查：
```powershell
netstat -ano | findstr "20102"
```
如果有输出，说明玩家端正在运行。

### Q: 前端修改后没有生效？
A: Vite开发服务器支持热更新，但环境变量修改需要重启：
```bash
# Ctrl+C 停止服务
# 然后重新启动
npm run dev
```
