# Game-AI 客服系统优化计划书

> 文档版本: v1.1
> 编写日期: 2025-12-25
> 项目阶段: **快速开发期**
> 项目状态: 生产可用，综合评分 7.2/10

---

## 目录

1. [执行摘要](#1-执行摘要)
2. [现状分析](#2-现状分析)
3. [优化目标](#3-优化目标)
4. [Phase 1: 开发效率提升 (P0)](#4-phase-1-开发效率提升-p0)
5. [Phase 2: 代码质量保障 (P1)](#5-phase-2-代码质量保障-p1)
6. [Phase 3: 性能优化 (P2)](#6-phase-3-性能优化-p2)
7. [Phase 4: 架构重构 (延后)](#7-phase-4-架构重构-延后)
8. [Phase 5: 监控体系 (上线前)](#8-phase-5-监控体系-上线前)
9. [风险评估与缓解](#9-风险评估与缓解)
10. [验收标准](#10-验收标准)

---

## 1. 执行摘要

### 1.1 项目概述

Game-AI 是一个以"前置分流"和"智能路由"为核心的多游戏AI客服平台，采用 NestJS + React + PostgreSQL + Redis 技术栈，当前已具备生产可用水平。

### 1.2 当前阶段：快速开发期

本计划针对**快速开发阶段**制定，核心原则：
- **功能优先**：快速交付新功能
- **轻量优化**：只做必要的优化，避免过度工程
- **技术债务可控**：记录但延后非紧急重构
- **监控延后**：Prometheus/Grafana 等监控系统在正式上线前再启用

### 1.3 核心发现

| 维度 | 现状评分 | 短期目标 | 优先级 |
|------|---------|---------|--------|
| 开发效率 | 7/10 | 8/10 | **P0** |
| 代码质量 | 7/10 | 8/10 | **P1** |
| 性能表现 | 8/10 | 8/10 | P2 |
| 架构设计 | 8/10 | 8/10 | 延后 |
| 可观测性 | 5/10 | 5/10 | 上线前 |

### 1.4 优化优先级总览（快速开发版）

```
Phase 1 (P0): 开发效率提升 - API文档、错误处理、开发工具
Phase 2 (P1): 代码质量保障 - 关键测试、安全基线、代码规范
Phase 3 (P2): 性能优化     - 必要的缓存和查询优化
Phase 4 (延后): 架构重构    - Service拆分（功能稳定后）
Phase 5 (上线前): 监控体系  - Prometheus + Grafana + 告警
```

---

## 2. 现状分析

### 2.1 技术栈现状

| 层级 | 技术选型 | 版本 | 评价 |
|------|---------|------|------|
| 后端框架 | NestJS | 10.3 | 成熟稳定 |
| 前端框架 | React | 18.2 | 主流选择 |
| 数据库 | PostgreSQL | 14+ | 企业级 |
| 缓存 | Redis | 7 | 高性能 |
| ORM | Prisma | 5.7 | 类型安全 |
| 实时通信 | Socket.io | 4.7 | 跨平台 |

### 2.2 代码规模统计

| 模块 | 代码行数 | 文件数 | 复杂度评估 |
|------|---------|-------|-----------|
| Session Service | 2,256 | 1 | 过高，需拆分 |
| Ticket Service | 1,738 | 1 | 过高，需拆分 |
| WebSocket Gateway | 867 | 1 | 中等 |
| Logger System | 700 | 5 | 合理 |
| 后端总计 | ~50K | 130 | 中等规模 |

### 2.3 已完成的优化

1. **日志系统优化** (2025-12-22)
   - 字段缩写化: 节省 40-50% 空间
   - 动态采样: 减少 80% 日志量
   - Redis异步缓冲: 解耦IO操作

2. **数据库索引优化** (2025-12-25)
   - 添加 18 个复合索引
   - 优化查询路径

3. **限流与熔断机制**
   - 429错误自动熔断
   - Redis存储限流状态

---

## 3. 优化目标

### 3.1 量化目标

| 指标 | 当前值 | 目标值 | 提升幅度 |
|------|-------|-------|---------|
| 单元测试覆盖率 | 0% | 80% | +80% |
| API响应时间 P99 | 未知 | <500ms | - |
| 系统可用性 | 未知 | 99.9% | - |
| 安全漏洞数 | 待评估 | 0 (高危) | - |
| 代码复杂度 | 高 | 中低 | 降低50% |

### 3.2 质量目标

- 所有核心功能具备单元测试
- 完整的监控告警体系
- 安全最佳实践全覆盖
- API文档100%覆盖

---

## 4. Phase 1: 开发效率提升 (P0)

> 优先级: **最高**
> 目标: 提升开发速度，减少调试时间

### 4.1 API 文档完善

#### 4.1.1 Swagger 文档补充

**现状**: 部分 Controller 缺少完整的 Swagger 装饰器

**优化方案**:

```typescript
// 为所有 DTO 添加 @ApiProperty 装饰器
// backend/src/ticket/dto/create-ticket.dto.ts
export class CreateTicketDto {
  @ApiProperty({ description: '游戏ID', example: 'game-001' })
  @IsString()
  gameId: string;

  @ApiProperty({ description: '问题描述', example: '充值未到账' })
  @IsString()
  @MaxLength(2000)
  description: string;

  @ApiProperty({ description: '优先级', enum: Priority, default: Priority.NORMAL })
  @IsOptional()
  @IsEnum(Priority)
  priority?: Priority;
}

// 为 Controller 方法添加响应类型
@ApiOperation({ summary: '创建工单' })
@ApiResponse({ status: 201, description: '创建成功', type: TicketResponseDto })
@ApiResponse({ status: 400, description: '参数错误' })
@Post()
async create(@Body() dto: CreateTicketDto) {}
```

**待补充模块清单**:

| 模块 | 当前覆盖率 | 目标 | 优先级 |
|------|-----------|------|--------|
| TicketController | 60% | 100% | 高 |
| SessionController | 50% | 100% | 高 |
| MessageController | 40% | 100% | 中 |
| QuickReplyController | 70% | 100% | 低 |

### 4.2 错误处理标准化

#### 4.2.1 统一错误码体系

```typescript
// backend/src/common/exceptions/error-codes.ts
export const ErrorCodes = {
  // 认证相关 (1xxx)
  AUTH_INVALID_TOKEN: 'E1001',
  AUTH_TOKEN_EXPIRED: 'E1002',
  AUTH_PERMISSION_DENIED: 'E1003',

  // 工单相关 (2xxx)
  TICKET_NOT_FOUND: 'E2001',
  TICKET_ALREADY_CLOSED: 'E2002',
  TICKET_INVALID_STATUS: 'E2003',

  // 会话相关 (3xxx)
  SESSION_NOT_FOUND: 'E3001',
  SESSION_ALREADY_ASSIGNED: 'E3002',

  // 系统相关 (9xxx)
  SYSTEM_INTERNAL_ERROR: 'E9001',
  SYSTEM_SERVICE_UNAVAILABLE: 'E9002',
};

// backend/src/common/exceptions/business.exception.ts
export class BusinessException extends HttpException {
  constructor(
    public readonly code: string,
    public readonly message: string,
    public readonly data?: any,
    status: HttpStatus = HttpStatus.BAD_REQUEST,
  ) {
    super({ code, message, data }, status);
  }
}
```

#### 4.2.2 前端错误码映射

```typescript
// frontend/*/src/utils/error-handler.ts
const ERROR_MESSAGES: Record<string, string> = {
  'E1001': '登录已失效，请重新登录',
  'E1002': '登录已过期，请重新登录',
  'E2001': '工单不存在',
  'E2002': '工单已关闭，无法操作',
  'E3001': '会话不存在',
};

export function handleApiError(error: ApiError): string {
  return ERROR_MESSAGES[error.code] || error.message || '操作失败，请重试';
}
```

### 4.3 开发工具优化

#### 4.3.1 热重载优化

```json
// backend/package.json - 确保开发模式配置正确
{
  "scripts": {
    "start:dev": "nest start --watch",
    "start:debug": "nest start --debug --watch"
  }
}
```

#### 4.3.2 VSCode 调试配置

```json
// .vscode/launch.json
{
  "version": "0.2.0",
  "configurations": [
    {
      "type": "node",
      "request": "attach",
      "name": "Attach to Backend",
      "port": 9229,
      "restart": true,
      "sourceMaps": true,
      "localRoot": "${workspaceFolder}/backend",
      "remoteRoot": "/app"
    }
  ]
}
```

#### 4.3.3 数据库可视化工具

```bash
# 推荐使用 Prisma Studio 进行数据调试
cd backend && npx prisma studio
# 访问 http://localhost:5555
```

### 4.4 日志调试增强

#### 4.4.1 开发环境日志优化

```typescript
// backend/src/common/logger/logger.service.ts
// 开发环境输出更详细的日志
if (process.env.NODE_ENV === 'development') {
  // 输出完整的请求/响应体
  // 输出 SQL 查询语句
  // 输出堆栈跟踪
}
```

#### 4.4.2 请求追踪简化

```typescript
// 确保每个请求都有 traceId，方便调试
// 已实现，确认正常工作即可
```

### 4.5 TODO 功能快速实现

#### 4.5.1 待实现功能清单

根据代码扫描，发现以下 TODO 项：

| 位置 | TODO 内容 | 优先级 | 建议 |
|------|----------|--------|------|
| ticket.service.ts | 支付验证 API | 中 | 先用 Mock 实现 |
| ticket-message.service.ts | 游戏内邮件通知 | 低 | 可延后 |

#### 4.5.2 Mock 服务快速实现

```typescript
// backend/src/ticket/services/payment-verification.service.ts
@Injectable()
export class PaymentVerificationService {
  async verifyPayment(params: VerifyPaymentDto): Promise<PaymentResult> {
    // 开发阶段使用 Mock
    if (process.env.NODE_ENV === 'development') {
      return {
        isVerified: true,
        totalAmount: 1000,
        vipLevel: 5,
        mockData: true,
      };
    }

    // TODO: 正式环境调用真实 API
    throw new Error('Payment verification not implemented for production');
  }
}
```

---

## 5. Phase 2: 代码质量保障 (P1)

> 优先级: **高**
> 目标: 保障核心功能稳定，避免回归问题

### 5.1 关键路径测试

#### 5.1.1 测试策略（轻量版）

**原则**: 快速开发阶段只测试核心路径，不追求高覆盖率

```javascript
// backend/jest.config.js
module.exports = {
  moduleFileExtensions: ['js', 'json', 'ts'],
  rootDir: 'src',
  testRegex: '.*\\.spec\\.ts$',
  transform: { '^.+\\.(t|j)s$': 'ts-jest' },
  testEnvironment: 'node',
  // 快速开发阶段：不强制覆盖率
  // coverageThreshold: { global: { lines: 80 } },
};
```

#### 5.1.2 优先测试的功能点

| 功能 | 测试类型 | 重要性 | 用例数 |
|------|---------|--------|--------|
| 工单创建流程 | 集成测试 | 高 | 5 |
| 会话转人工 | 集成测试 | 高 | 3 |
| JWT认证 | 单元测试 | 高 | 5 |
| WebSocket连接 | 集成测试 | 中 | 3 |

#### 5.1.3 核心流程测试示例

```typescript
// backend/src/ticket/__tests__/ticket-creation.spec.ts
describe('工单创建流程', () => {
  it('应该成功创建工单并生成工单号', async () => {
    const result = await ticketService.create({
      gameId: 'test-game',
      description: '测试问题',
      playerInfo: { playerId: 'player-1' },
    });

    expect(result.ticketNo).toMatch(/^T-\d{8}-\d{6}$/);
    expect(result.status).toBe('IN_PROGRESS');
  });

  it('应该拒绝无效的游戏ID', async () => {
    await expect(
      ticketService.create({ gameId: 'invalid', description: 'test' })
    ).rejects.toThrow('游戏不存在');
  });
});
```

### 5.2 安全基线

#### 5.2.1 必须立即修复的安全项

| 问题 | 风险等级 | 修复方案 | 工作量 |
|------|---------|---------|--------|
| 默认密码 | 高 | 部署时强制修改 | 小 |
| JWT密钥硬编码 | 高 | 从环境变量读取 | 小 |
| 文件类型检查 | 中 | 添加MIME验证 | 中 |

#### 5.2.2 快速修复：默认密码处理

```typescript
// backend/prisma/seed.ts
// 开发环境可以使用默认密码，生产环境必须从环境变量读取
const adminPassword = process.env.NODE_ENV === 'production'
  ? process.env.ADMIN_INITIAL_PASSWORD  // 必须设置
  : 'admin123';  // 开发环境默认值

if (process.env.NODE_ENV === 'production' && !process.env.ADMIN_INITIAL_PASSWORD) {
  throw new Error('生产环境必须设置 ADMIN_INITIAL_PASSWORD');
}
```

#### 5.2.3 文件上传安全（简化版）

```typescript
// backend/src/upload/upload.service.ts
const ALLOWED_EXTENSIONS = ['.jpg', '.jpeg', '.png', '.gif', '.pdf'];
const MAX_SIZE = 10 * 1024 * 1024; // 10MB

async validateFile(file: Express.Multer.File): Promise<void> {
  const ext = path.extname(file.originalname).toLowerCase();

  if (!ALLOWED_EXTENSIONS.includes(ext)) {
    throw new BadRequestException('不支持的文件类型');
  }

  if (file.size > MAX_SIZE) {
    throw new BadRequestException('文件大小超过10MB限制');
  }
}
```

### 5.3 代码规范统一

#### 5.3.1 ESLint 规则加强

```javascript
// backend/.eslintrc.js
module.exports = {
  rules: {
    // 禁止 console.log（使用 Logger）
    'no-console': 'warn',
    // 禁止未使用的变量
    '@typescript-eslint/no-unused-vars': 'error',
    // 要求显式返回类型
    '@typescript-eslint/explicit-function-return-type': 'off', // 快速开发阶段可关闭
  },
};
```

#### 5.3.2 Git Hooks（可选）

```json
// package.json - 如果需要可以启用
{
  "husky": {
    "hooks": {
      "pre-commit": "lint-staged"
    }
  },
  "lint-staged": {
    "*.ts": ["eslint --fix", "git add"]
  }
}
```

### 5.4 数据验证加强

#### 5.4.1 DTO 验证完善

```typescript
// 确保所有 DTO 都有完整的验证装饰器
// backend/src/ticket/dto/create-ticket.dto.ts
export class CreateTicketDto {
  @IsString()
  @IsNotEmpty({ message: '游戏ID不能为空' })
  gameId: string;

  @IsString()
  @IsNotEmpty({ message: '问题描述不能为空' })
  @MaxLength(2000, { message: '问题描述不能超过2000字' })
  description: string;

  @IsOptional()
  @IsEnum(Priority)
  priority?: Priority;
}
```

#### 5.4.2 全局验证管道

```typescript
// backend/src/main.ts - 确保已配置
app.useGlobalPipes(new ValidationPipe({
  whitelist: true,        // 过滤非DTO字段
  forbidNonWhitelisted: true,  // 禁止未知字段
  transform: true,        // 自动类型转换
}));
```

---

## 6. Phase 3: 性能优化 (P2)

> 优先级: **中**
> 目标: 解决明显的性能瓶颈，快速开发阶段只做必要优化

### 6.1 数据库查询优化（必要项）

#### 6.1.1 N+1 查询检查

**问题**: Prisma 关联查询可能产生 N+1 查询

**快速检查方法**:
```typescript
// 开发环境开启 Prisma 查询日志
// backend/src/prisma/prisma.service.ts
const prisma = new PrismaClient({
  log: process.env.NODE_ENV === 'development'
    ? ['query', 'warn', 'error']
    : ['error'],
});
```

**常见优化模式**:
```typescript
// 优化前 (N+1问题)
const tickets = await prisma.ticket.findMany();
for (const ticket of tickets) {
  ticket.sessions = await prisma.session.findMany({ where: { ticketId: ticket.id } });
}

// 优化后 (使用include)
const tickets = await prisma.ticket.findMany({
  include: { sessions: true },
});
```

#### 6.1.2 已有索引确认

2025-12-25 迁移已添加关键索引，确认以下索引正常工作：

| 表 | 索引 | 用途 |
|---|------|------|
| Ticket | [status, createdAt] | Dashboard 查询 |
| Session | [status, agentId] | 客服会话列表 |
| Message | [sessionId, createdAt] | 消息历史 |

### 6.2 简单缓存优化

#### 6.2.1 Dashboard 统计缓存

```typescript
// backend/src/dashboard/dashboard.service.ts
// 简单的内存缓存，避免频繁查询
private statsCache: DashboardStats | null = null;
private cacheTime: number = 0;
private readonly CACHE_TTL = 30 * 1000; // 30秒

async getStats(): Promise<DashboardStats> {
  const now = Date.now();
  if (this.statsCache && (now - this.cacheTime) < this.CACHE_TTL) {
    return this.statsCache;
  }

  const stats = await this.calculateStats();
  this.statsCache = stats;
  this.cacheTime = now;
  return stats;
}
```

#### 6.2.2 游戏配置缓存

```typescript
// backend/src/game/game.service.ts
// 游戏配置变化少，可以长时间缓存
private gamesCache: Map<string, Game> = new Map();

async findById(id: string): Promise<Game> {
  if (this.gamesCache.has(id)) {
    return this.gamesCache.get(id);
  }

  const game = await this.prisma.game.findUnique({ where: { id } });
  if (game) {
    this.gamesCache.set(id, game);
  }
  return game;
}

// 更新时清除缓存
async update(id: string, data: UpdateGameDto): Promise<Game> {
  const game = await this.prisma.game.update({ where: { id }, data });
  this.gamesCache.delete(id);
  return game;
}
```

### 6.3 前端性能优化（可选）

#### 6.3.1 路由懒加载

```typescript
// frontend/admin-portal/src/App.tsx
// 如果首屏加载慢，可以启用懒加载
const Dashboard = lazy(() => import('./pages/Dashboard'));
const Tickets = lazy(() => import('./pages/Tickets'));
```

#### 6.3.2 列表分页

确保所有列表接口都支持分页，避免一次加载过多数据：

```typescript
// 前端调用示例
const { data } = await api.getTickets({
  page: 1,
  pageSize: 20,
  status: 'IN_PROGRESS',
});
```

### 6.4 WebSocket 稳定性

#### 6.4.1 重连机制确认

```typescript
// frontend/*/src/services/websocket.service.ts
// 确保有重连逻辑
socket.on('disconnect', () => {
  setTimeout(() => {
    socket.connect();
  }, 3000); // 3秒后重连
});
```

#### 6.4.2 心跳配置

```typescript
// 已配置，确认正常工作
// backend/src/websocket/websocket.gateway.ts
@WebSocketGateway({
  pingInterval: 25000,
  pingTimeout: 60000,
})
```

---

## 7. Phase 4: 架构重构 (延后)

> 优先级: **低 - 功能稳定后再进行**
> 目标: 提升可维护性，降低单文件复杂度

### 7.1 技术债务记录

#### 7.1.1 大Service类问题

| 文件 | 当前行数 | 问题 | 建议拆分 |
|------|---------|------|---------|
| session.service.ts | 2,256 | 职责过多 | 4个子服务 |
| ticket.service.ts | 1,738 | 职责过多 | 4个子服务 |
| websocket.gateway.ts | 867 | 可接受 | 暂不处理 |

#### 7.1.2 拆分方案（备忘）

**SessionService 拆分方向**:
```
SessionService (2256行) → 拆分为:
├── SessionLifecycleService (创建/关闭)
├── SessionQueueService (排队管理)
├── SessionTransferService (转人工)
└── SessionQueryService (查询)
```

**TicketService 拆分方向**:
```
TicketService (1738行) → 拆分为:
├── TicketCreationService (创建/工单号生成)
├── TicketStatusService (状态管理)
├── TicketSearchService (查询/搜索)
└── TicketPriorityService (优先级)
```

### 7.2 重构时机判断

**何时进行重构**:
- [ ] 核心功能开发完成
- [ ] 准备进入稳定维护期
- [ ] 新增功能难以在现有结构中实现
- [ ] 团队扩大需要多人协作同一模块

**重构前置条件**:
- [ ] 有足够的测试覆盖（至少核心路径）
- [ ] 预留充足时间进行回归测试

### 7.3 渐进式重构策略

如果必须在开发期间进行小规模重构：

```typescript
// 1. 先提取为私有方法
class SessionService {
  // 原有代码
  async transferToAgent(sessionId: string) {
    // 很长的逻辑...
  }

  // 改为
  async transferToAgent(sessionId: string) {
    const session = await this.findSession(sessionId);
    const agent = await this.findAvailableAgent();
    await this.doTransfer(session, agent);
  }

  private async findAvailableAgent() { /* 提取的逻辑 */ }
  private async doTransfer() { /* 提取的逻辑 */ }
}

// 2. 稳定后再提取为独立服务
```

---

## 8. Phase 5: 监控体系 (上线前)

> 优先级: **上线前必须完成**
> 目标: 生产环境可观测性

### 8.1 监控系统启用清单

#### 8.1.1 上线前需要启用的服务

```yaml
# docker-compose.yml - 上线前取消注释
services:
  prometheus:
    image: prom/prometheus:v2.47.0
    # ...

  grafana:
    image: grafana/grafana:10.1.0
    # ...

  # 可选：日志聚合
  loki:
    image: grafana/loki:2.9.0
    # ...
```

#### 8.1.2 启用步骤

1. **取消注释 docker-compose.yml 中的监控服务**
2. **启用 MetricsModule**:
   ```typescript
   // backend/src/app.module.ts
   @Module({
     imports: [
       MetricsModule, // 取消注释
     ],
   })
   ```
3. **配置 Grafana Dashboard**
4. **配置告警规则**

### 8.2 健康检查端点

**上线前必须添加**:

```typescript
// backend/src/health/health.controller.ts
@Controller('health')
export class HealthController {
  @Get()
  health() {
    return { status: 'ok', timestamp: new Date().toISOString() };
  }

  @Get('ready')
  async ready() {
    // 检查数据库和Redis连接
    const dbOk = await this.checkDatabase();
    const redisOk = await this.checkRedis();

    if (dbOk && redisOk) {
      return { status: 'ready' };
    }
    throw new ServiceUnavailableException('Service not ready');
  }
}
```

### 8.3 基础告警规则

```yaml
# 上线前配置
groups:
  - name: game-ai-critical
    rules:
      - alert: ServiceDown
        expr: up == 0
        for: 1m
        labels:
          severity: critical

      - alert: HighErrorRate
        expr: rate(http_requests_total{status=~"5.."}[5m]) > 0.05
        for: 5m
        labels:
          severity: critical

      - alert: DatabaseConnectionFailed
        expr: pg_up == 0
        for: 1m
        labels:
          severity: critical
```

### 8.4 日志聚合（可选）

当前日志系统已经做了优化，如果需要集中查看日志：

1. 启用 Loki
2. 配置 Promtail 收集日志
3. 在 Grafana 中配置日志数据源

---

## 9. 风险评估与缓解

### 9.1 快速开发阶段的主要风险

| 风险 | 可能性 | 影响 | 缓解措施 |
|------|-------|------|---------|
| 技术债务累积 | 高 | 中 | 记录TODO，定期Review |
| 缺少测试导致回归 | 中 | 高 | 至少测试核心路径 |
| 安全漏洞 | 低 | 高 | 遵循安全基线 |
| 性能问题上线后暴露 | 中 | 中 | 上线前压测 |

### 9.2 快速回滚策略

```bash
# 1. 代码快速回滚
git revert HEAD  # 回滚最近一个提交

# 2. Docker 快速重启
docker-compose restart backend

# 3. 数据库回滚（谨慎使用）
# 建议：每次部署前备份
pg_dump -h localhost -U postgres game_ai_cs > backup_$(date +%Y%m%d).sql
```

### 9.3 开发阶段注意事项

1. **每日备份数据库**（至少开发环境）
2. **重要功能合并前自测**
3. **保持 .env.example 与实际配置同步**
4. **记录所有临时方案和 TODO**

---

## 10. 验收标准

### 10.1 Phase 1 验收标准（开发效率提升）

- [ ] Swagger API 文档覆盖所有核心接口
- [ ] 统一错误码体系实施
- [ ] 前端错误提示友好化
- [ ] 开发调试工具配置完成

### 10.2 Phase 2 验收标准（代码质量保障）

- [ ] 核心路径测试用例 >= 15 个
- [ ] 安全基线检查通过（默认密码、JWT密钥）
- [ ] 文件上传安全验证实施
- [ ] DTO 验证完整

### 10.3 Phase 3 验收标准（性能优化）

- [ ] 无明显 N+1 查询问题
- [ ] Dashboard 统计有缓存
- [ ] 列表接口支持分页
- [ ] WebSocket 重连机制正常

### 10.4 Phase 4 验收标准（架构重构 - 延后）

- [ ] 技术债务已记录
- [ ] 拆分方案已设计
- [ ] 等待功能稳定后执行

### 10.5 Phase 5 验收标准（监控体系 - 上线前）

- [ ] Prometheus + Grafana 启用
- [ ] 健康检查端点可用
- [ ] 基础告警规则配置
- [ ] 日志可查询

---

## 附录

### A. 相关文档链接

- [产品使用文档](./产品使用文档.md)
- [运维部署命令](./运维部署命令.md)
- [API 文档](http://localhost:21101/api-docs)

### B. 技术选型参考

| 场景 | 推荐方案 | 备选方案 |
|------|---------|---------|
| 单元测试 | Jest | Vitest |
| 监控 | Prometheus + Grafana | Datadog |
| 日志聚合 | Loki | ELK Stack |
| 分布式追踪 | Jaeger | Zipkin |
| 密钥管理 | HashiCorp Vault | AWS Secrets Manager |

### C. 版本历史

| 版本 | 日期 | 作者 | 变更说明 |
|------|------|------|---------|
| v1.0 | 2025-12-25 | AI Assistant | 初始版本 |

---

> 本计划书由 AI 基于系统深度分析自动生成，建议与团队讨论后根据实际情况调整优先级和实施方案。
