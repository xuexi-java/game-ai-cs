# 数据库配置
# 开发环境使用本地 PostgreSQL（默认端口 5432）
DATABASE_URL="postgresql://postgres:your-password@localhost:5432/game_ai_cs?schema=public"

# 生产环境示例
# DATABASE_URL="postgresql://cs_app:your-secure-password@your-db-host:5432/cs_prod_db?schema=public"

# JWT 配置
# 生产环境请生成随机密钥: openssl rand -base64 32
JWT_SECRET="KQnYxA8fQvF6E3W2kC7m0nJ9XH2Zs5PpU8bQwR4dE="
JWT_EXPIRES_IN="1h"

# Redis 配置
REDIS_URL="redis://localhost:6379"
# REDIS_HOST="localhost"
# REDIS_PORT=6379
REDIS_MAX_RETRIES_PER_REQUEST=3
REDIS_MAX_RECONNECT_ATTEMPTS=5
REDIS_RETRY_DELAY_BASE=200
REDIS_RETRY_DELAY_MAX=2000
REDIS_CONNECT_TIMEOUT=5000
REDIS_PING_TIMEOUT=2000
METRICS_KEY="change-me"

# Cache
CACHE_ENABLED=true
CACHE_JITTER_PCT=0.1
CACHE_CONFIG_TTL_SECONDS=900
CACHE_QUICK_REPLY_TTL_SECONDS=60
DASHBOARD_CACHE_TTL_SECONDS=60
DASHBOARD_SNAPSHOT_TTL_SECONDS=300
DASHBOARD_DEGRADED_TTL_SECONDS=300
DASHBOARD_DEGRADE_EVENT_LOOP_MS=200
DASHBOARD_DEGRADE_CPU_LOAD_RATIO=1.2
DASHBOARD_DEGRADE_QUERY_MS=1500
DASHBOARD_DEGRADED=false

# 服务器配置
PORT=21101
NODE_ENV="development"

# 日志配置
# LOG_LEVEL: DEBUG | INFO | WARN | ERROR
# 开发环境建议 DEBUG，生产环境建议 INFO
LOG_LEVEL="INFO"

# 日志采样率 (0.0-1.0)，仅对成功且快速的请求生效
LOG_SAMPLING_RATE="0.1"

# 日志批量写入配置
LOG_BATCH_SIZE=100
LOG_BATCH_INTERVAL=100

# 内存队列保护（防止内存溢出）
LOG_MAX_QUEUE_SIZE=10000

# 日志压缩归档配置
LOG_ENABLE_COMPRESSION=true
LOG_ARCHIVE_AFTER_DAYS=7
LOG_CLEAN_AFTER_DAYS=30

# Redis 日志缓冲配置（可选，默认关闭）
LOG_USE_REDIS_BUFFER=false
LOG_REDIS_KEY=system:logs:buffer
LOG_REDIS_MAX_SIZE=10000

# 前端 URL（支持多个，用逗号分隔）
FRONTEND_URL="http://localhost:20001,http://localhost:20002"
# 开发环境默认 CORS 允许的域名（用逗号分隔）
# CORS_DEFAULT_DEV_ORIGINS="http://localhost:20101,http://localhost:20102,http://127.0.0.1:20101,http://127.0.0.1:20102"

# 文件上传配置
UPLOAD_DIR="./uploads"
MAX_FILE_SIZE=10485760

# Dify API 配置（生产环境必须设置）
DIFY_API_KEY=app-your-dify-api-key-here
DIFY_BASE_URL=http://your-dify-server/v1

# ==================== WebSocket 配置 ====================

# WebSocket URL（玩家客户端连接地址）
# 开发环境: ws://localhost:21101
# 生产环境: wss://your-domain.com 或 wss://cs.your-game.com
WS_URL="ws://localhost:21101"

# 心跳检测配置（15秒*3次=45秒超时断开）
WS_HEARTBEAT_CHECK_INTERVAL=15000
WS_HEARTBEAT_MAX_MISSED=3
WS_HEARTBEAT_PING_TIMEOUT=15000

# WebSocket 状态 TTL（秒）
WS_STATE_TTL=86400

# WebSocket 限流配置
WS_PLAYER_RATE_LIMIT=200
WS_AGENT_RATE_LIMIT=600
WS_PLAYER_BURST=20
WS_AGENT_BURST=60
WS_RATE_LIMIT_NOTICE_COOLDOWN=1000

# ==================== 队列服务配置 ====================

# 队列重试配置
QUEUE_RETRY_DELAY_BASE=1000
QUEUE_RETRY_DELAY_MAX=4000
QUEUE_MAX_RETRIES=3

# ==================== 限流配置 ====================

# 全局限流（每分钟）
THROTTLE_GLOBAL_TTL=60000
THROTTLE_GLOBAL_LIMIT=200

# Dify API 限流（每分钟）
THROTTLE_DIFY_TTL=60000
THROTTLE_DIFY_LIMIT=100

# 会话接口限流（每分钟）
THROTTLE_SESSION_TTL=60000
THROTTLE_SESSION_LIMIT=1000

# 工单接口限流（每分钟）
THROTTLE_TICKET_TTL=60000
THROTTLE_TICKET_LIMIT=1000

# ==================== 安全配置 ====================

# 加密密钥（生产环境必须设置！）
# 生成命令: openssl rand -hex 32 (生成64字符密钥)
ENCRYPTION_SECRET_KEY="your-64-character-encryption-key-here-replace-me"
ENCRYPTION_SALT="your-unique-salt-value-replace-me"

# Player API Token 密钥（生产环境必须设置！）
# 这些密钥用于玩家端 WebView 接入的 Token 生成和验证
# 生成命令: openssl rand -base64 32
WS_TOKEN_SECRET="your-ws-token-secret-base64-replace-me"
UPLOAD_TOKEN_SECRET="your-upload-token-secret-base64-replace-me"
SESSION_TOKEN_SECRET="your-session-token-secret-base64-replace-me"

# Player API Token 有效期（秒）
PLAYER_API_WS_TOKEN_TTL=7200
PLAYER_API_UPLOAD_TOKEN_TTL=600

# 签名有效期（毫秒）
# 默认: 7200000（2小时）
# 说明: 玩家请求签名的有效时间窗口，超过此时间签名将被拒绝
PLAYER_API_SIGN_EXPIRY_MS=7200000

# Dify API 默认查询限制
DIFY_DEFAULT_LIMIT=20

# 工单自动关闭配置
# 详细说明请参考: docs/工单自动关闭配置指南.md

# 启用/禁用自动关闭功能
# 值: true | false
# 默认: true
# 说明: 设置为 false 可以临时禁用自动关闭功能
ENABLE_AUTO_CLOSURE=true

# WAITING 状态工单超时时间（小时）
# 默认: 72（3天）
# 建议范围: 48-168（2-7天）
# 说明: 等待客服响应的工单超时时间
WAITING_TIMEOUT_HOURS=72

# IN_PROGRESS 状态工单（客服已回复）超时时间（小时）
# 默认: 24（1天）
# 建议范围: 12-72（0.5-3天）
# 说明: 客服已回复但玩家未响应的工单超时时间
REPLIED_TIMEOUT_HOURS=24
