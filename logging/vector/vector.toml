data_dir = "/var/lib/vector"

[sources.backend_docker]
type = "docker_logs"
include_containers = ["game-ai-cs-backend"]
ignore_older_secs = 600

[transforms.parse_backend]
type = "remap"
inputs = ["backend_docker"]
source = '''
.message = to_string(.message)
parsed, err = parse_json(.message)
if err == null {
  .log = parsed
  .level = parsed.level
  .context = parsed.context
  .traceId = parsed.traceId
  .userId = parsed.userId
  .message = parsed.message
  .timestamp = parsed.timestamp
}
'''

[sinks.loki]
type = "loki"
inputs = ["parse_backend"]
endpoint = "${LOKI_ENDPOINT}"
labels = { service = "game-ai-cs-backend", level = "{{ level }}", container = "{{ container_name }}" }
encoding.codec = "json"
