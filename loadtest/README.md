# 性能与压力测试计划书（game-ai-cs）

## 1. 测试目标

* 验证系统在**预期业务负载**下的性能是否达标
* 评估系统在**高并发场景**下的稳定性
* 找出系统**容量上限与性能瓶颈**
* 为上线与容量规划提供数据依据

---

## 2. 测试范围

### 2.1 包含范围

* 用户鉴权与会话管理
* 客服/玩家核心业务流程
* AI 消息处理能力
* WebSocket 实时通信
* 管理端查询与操作接口
* 后端服务与数据库整体表现

### 2.2 不包含范围

* 运维后台低频接口
* 非线上使用的调试接口
* 单机算法准确性验证

---

## 3. 测试类型

| 类型      | 说明              |
| ------- | --------------- |
| 性能测试    | 稳定负载下验证响应时间、吞吐量 |
| 压力测试    | 逐步加压，找系统极限      |
| 稳定性测试   | 长时间运行（如 1–2 小时） |
| 单接口基线测试 | 为问题定位提供参考       |

---

## 4. 测试场景设计（核心）

### 4.1 业务场景说明

系统典型用户行为为：

```
用户进入系统
 → 鉴权 / 建立会话
 → 发送咨询消息
 → AI 处理并返回结果
 → 实时消息推送
 → 查询会话/工单状态
```

管理端用户行为为：

```
登录管理端
 → 查询会话/工单列表
 → 查看详情
 → 更新状态
```

---

## 5. 测试类（User Class / 测试脚本）设计

> **重点：明确需要创建的测试类数量与职责**

### ✅ 共需创建 **5 个测试类**

---

### 🧩 测试类 1：鉴权用户类（AuthUser）

**职责：**

* 模拟用户登录/鉴权
* 获取并维护访问凭证

**覆盖场景：**

* 正常登录
* 高并发登录
* 凭证有效性

**用途：**

* 单接口基线测试
* 其他测试类的前置依赖

---

### 🧩 测试类 2：普通玩家业务流用户类（PlayerUser）

**职责：**

* 模拟玩家完整咨询流程
* 覆盖最核心业务链路

**行为组合：**

* 初始化会话
* 发送消息
* 接收 AI 回复
* 查询会话状态

**用途：**

* 核心性能测试
* 压力测试主力

---

### 🧩 测试类 3：AI 消息高并发用户类（AIMessageUser）

**职责：**

* 专注压测 AI 相关处理能力
* 不包含完整业务流程

**行为特点：**

* 高频消息发送
* 短思考时间
* 高并发

**用途：**

* 找 AI 服务 / 下游依赖瓶颈
* 验证 AI 响应时间上限

---

### 🧩 测试类 4：WebSocket 长连接用户类（WsUser）

**职责：**

* 模拟大量在线用户
* 维持 WebSocket 长连接
* 接收服务端推送

**覆盖点：**

* 连接建立
* 心跳
* 消息推送
* 断线重连

**用途：**

* 在线用户规模评估
* 实时通信稳定性测试

---

### 🧩 测试类 5：管理端用户类（AdminUser）

**职责：**

* 模拟后台管理人员操作
* 查询与管理业务数据

**行为特点：**

* 查询为主
* 并发低于玩家端
* 接口复杂度较高

**用途：**

* 验证后台在高负载下是否被拖慢
* 防止管理端被前台流量影响

---

## 6. 测试负载模型

### 6.1 性能测试（稳定负载）

| 用户类型          | 并发占比 |
| ------------- | ---- |
| PlayerUser    | 60%  |
| AIMessageUser | 15%  |
| WsUser        | 15%  |
| AdminUser     | 5%   |
| AuthUser      | 5%   |

---

### 6.2 压力测试（阶梯加压）

```
100 → 300 → 500 → 800 → 1000+
```

观察系统拐点并记录。

---

## 7. 关键性能指标（KPI）

* 平均响应时间
* P90 / P95 响应时间
* 吞吐量（RPS / TPS）
* 错误率
* WebSocket 在线连接数
* CPU / 内存 / 数据库连接数

---

## 8. 测试环境要求

* 独立测试环境
* 接近生产配置
* 数据库、缓存、AI 依赖真实或等价
* 开启完整监控

---

## 9. 测试交付物

* 测试脚本（5 个测试类）
* 性能测试报告
* 压力测试报告
* 系统容量评估结论
* 性能瓶颈与优化建议

---

## 10. 总结

* 不只测试单接口，而是**按业务角色建模**
* 通过 **5 类测试用户** 覆盖主要使用场景
* 性能测试关注“是否达标”
* 压力测试关注“能撑到哪里”

